<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>TCP-IMPL Mailing List Archive: Re: Timeout in FIN-WAIT-2</TITLE>
<META NAME="Author" CONTENT="Vernon Schryver (vjs@calcite.rhyolite.com)">
<META NAME="Subject" CONTENT="Re: Timeout in FIN-WAIT-2">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1>Re: Timeout in FIN-WAIT-2</H1>
<!-- received="Fri Aug 21 09:30:55 1998" -->
<!-- isoreceived="19980821133055" -->
<!-- sent="Fri, 21 Aug 1998 10:29:54 -0600 (MDT)" -->
<!-- isosent="19980821162954" -->
<!-- name="Vernon Schryver" -->
<!-- email="vjs@calcite.rhyolite.com" -->
<!-- subject="Re: Timeout in FIN-WAIT-2" -->
<!-- id="199808211629.KAA03517@calcite.rhyolite.com" -->
<!-- inreplyto="Timeout in FIN-WAIT-2" -->
<STRONG>From:</STRONG> Vernon Schryver (<A HREF="mailto:vjs@calcite.rhyolite.com?Subject=Re:%20Timeout%20in%20FIN-WAIT-2&In-Reply-To=&lt;199808211629.KAA03517@calcite.rhyolite.com&gt;"><EM>vjs@calcite.rhyolite.com</EM></A>)<BR>
<STRONG>Date:</STRONG> Fri Aug 21 1998 - 12:29:54 EDT
<P>
<!-- next="start" -->
<UL>
<LI><STRONG>Next message:</STRONG> <A HREF="1264.html">Alan Cox: "Re: Timeout in FIN-WAIT-2"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="1262.html">der Mouse : "Re: Timeout in FIN-WAIT-2"</A>
<LI><STRONG>Maybe in reply to:</STRONG> <A HREF="1211.html">der Mouse : "Timeout in FIN-WAIT-2"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="1265.html">Alan Cox: "Re: Timeout in FIN-WAIT-2"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="1265.html">Alan Cox: "Re: Timeout in FIN-WAIT-2"</A>
<!-- reply="end" -->
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#1263">[ date ]</A>
<A HREF="index.html#1263">[ thread ]</A>
<A HREF="subject.html#1263">[ subject ]</A>
<A HREF="author.html#1263">[ author ]</A>
</UL>
<HR NOSHADE><P>
<!-- body="start" -->
<P>
<EM>&gt; &gt; &gt; Im not arguing that der Mouse is doing the right thing in his circumstances.
</EM><BR>
<EM>&gt; &gt; &gt; But we can't make every random faulty piece of equipment an item to assess
</EM><BR>
<EM>&gt; &gt; &gt; when evaluating the need for keepalives.
</EM><BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; It isn't a &quot;faulty piece of equipment&quot;.
</EM><BR>
<P>On the contrary, even der Mouse has agreed that the firewall is faulty.
<BR>
<P><EM>&gt; Well with RFC compliant keepalives his sessions get killed right ?
</EM><BR>
<P>Please re-read RFC 1122.  4.2.3.6 says only that the keepalives must
<BR>
default to &quot;off&quot; and that the default interval must be no less than
<BR>
2 hours.  Thus, a 5 minute keepalive is conformant.
<BR>
<P><EM>&gt; ...
</EM><BR>
<EM>&gt; Therefore the firewall is buggy against the RFC's it should have been
</EM><BR>
<EM>&gt; configured with respect to.
</EM><BR>
<P>What RFC does the firewall violate?  I can't think of one.  It obviously
<BR>
violates common sense and decency, but that's all too common among such
<BR>
products.  For some reason, many people (using the word losely) who make
<BR>
so called security products, as well as many people (ditto) who buy or
<BR>
mandate them, care nothing about real security or the reasons that justify
<BR>
the existence of the targets of their snake oil.  A stateful firewall that
<BR>
kills all connections after 5 minutes is to be expected from the crowd
<BR>
that turns off all source-routing because some hosts were broken, or that
<BR>
makes firewalls that filter all of ICMP lest some host somewhere get a
<BR>
Redirect.
<BR>
<P><P><EM>&gt; I cannot see how anyone can argue otherwise. Thats why its not relevant
</EM><BR>
<EM>&gt; to the keepalive argument. a) its not RFC spec b) its fixable without
</EM><BR>
<EM>&gt; breaking the rfc spec externally.
</EM><BR>
<P>Again, contrary to which RFC?
<BR>
<P>Consider also that making a firewall spoofs keepalives sounds interesting
<BR>
(i.e.  non-trivial) and entirely beyond the capabilities or even conception
<BR>
of anyone stupid enough to have designed the box at issue.  Think of some
<BR>
of the problems.  After the firewall forges a keepalive and an Ack comes
<BR>
back, does it pass the Ack in the expectation that the other host will do
<BR>
the right thing and ignore it?  Or does it worry that the other host might
<BR>
be lame or that other packet counters or security stuff would have a fit?
<BR>
But if it just passes it, 50% as much bandwidth is consumed as if the host
<BR>
did its own 5 minute keepalive.  But if the firewall filters the Ack, how
<BR>
does it avoid filtering Acks generated by keepalives from the host being
<BR>
spoofed?--given packet losses, it is impossible to know which is which.
<BR>
Then there are mundane hassles such as adding keepalive restransmission
<BR>
timers to the firewall per-connection state; as RFC 1122 says, you can't
<BR>
drop a connection after a single keepalive fails to produce a response.
<BR>
I'm not convinced the idea is a good one, but if it is, the problems are
<BR>
interesting and solvable.  Interesting problems are clearly beyond the
<BR>
designers of the original box.
<BR>
<P><P><EM>&gt; ... 
</EM><BR>
<EM>&gt; Suppose I have a firewall that doesnt do state checks by spoofing
</EM><BR>
<EM>&gt; keepalives internally. Now I sell it to 3ciscoscendnet  and their bright
</EM><BR>
<EM>&gt; marketing people provide a nice windows configuration disk that sets the
</EM><BR>
<EM>&gt; 40,000 corporate windows PC's to use 5 minute keepalives. Now sell those
</EM><BR>
<EM>&gt; to every major corporation. 
</EM><BR>
<EM>&gt; ...
</EM><BR>
<P>Fortunately, a few customers, if not the engineers at 3Com et al, notice
<BR>
packet counts.  The first big outfit that deployed such sillines would be
<BR>
noticed by the competition, and its perpetrator would get a black eye.
<BR>
The next version would be fixed before the backbone of the Internet melted,
<BR>
or whatever is the catastrophy we're worried about.
<BR>
<P>You don't have to go to such extremes to find silly marketeers and stupid
<BR>
programmers that perpetrate bandwidth messes.  Look at Semantec's internet
<BR>
performance and checking stuff that comes (came?) with Win95 on PC's from
<BR>
Dell and others.  By default, it wants to `ping` a Semantec host.  A few
<BR>
months after I first saw that great joke, I saw a notice from Semantec
<BR>
saying advising the standard clueless customer to not worry if the tool
<BR>
said things weren't working.  I suspect a few 1,000,000 PC's banging away
<BR>
at the Semantic host did what anyone with half a brain would have
<BR>
predicted.
<BR>
<P><P>Vernon Schryver    <A HREF="mailto:vjs@rhyolite.com?Subject=Re:%20Timeout%20in%20FIN-WAIT-2&In-Reply-To=&lt;199808211629.KAA03517@calcite.rhyolite.com&gt;">vjs@rhyolite.com</A>
<BR>
<P><!-- body="end" -->
<HR NOSHADE>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="1264.html">Alan Cox: "Re: Timeout in FIN-WAIT-2"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="1262.html">der Mouse : "Re: Timeout in FIN-WAIT-2"</A>
<LI><STRONG>Maybe in reply to:</STRONG> <A HREF="1211.html">der Mouse : "Timeout in FIN-WAIT-2"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="1265.html">Alan Cox: "Re: Timeout in FIN-WAIT-2"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="1265.html">Alan Cox: "Re: Timeout in FIN-WAIT-2"</A>
<!-- reply="end" -->
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#1263">[ date ]</A>
<A HREF="index.html#1263">[ thread ]</A>
<A HREF="subject.html#1263">[ subject ]</A>
<A HREF="author.html#1263">[ author ]</A>
</UL>
<!-- trailer="footer" -->
<HR NOSHADE>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.hypermail.org/">hypermail 2b29</A> 
: <EM>Tue Sep 19 2000 - 11:52:53 EDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
