<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>TCP-IMPL Mailing List Archive: TCP timer problem</TITLE>
<META NAME="Author" CONTENT="Uwe Girlich (Uwe.Girlich@philosys.de)">
<META NAME="Subject" CONTENT="TCP timer problem">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1>TCP timer problem</H1>
<!-- received="Sun Mar  8 23:37:29 1998" -->
<!-- isoreceived="19980309043729" -->
<!-- sent="Mon, 9 Mar 1998 08:38:39 +0100 (MET)" -->
<!-- isosent="19980309073839" -->
<!-- name="Uwe Girlich" -->
<!-- email="Uwe.Girlich@philosys.de" -->
<!-- subject="TCP timer problem" -->
<!-- id="199803090738.IAA03831@philos.philosys.de" -->
<STRONG>From:</STRONG> Uwe Girlich (<A HREF="mailto:Uwe.Girlich@philosys.de?Subject=Re:%20TCP%20timer%20problem&In-Reply-To=&lt;199803090738.IAA03831@philos.philosys.de&gt;"><EM>Uwe.Girlich@philosys.de</EM></A>)<BR>
<STRONG>Date:</STRONG> Mon Mar 09 1998 - 02:38:39 EST
<P>
<!-- next="start" -->
<UL>
<LI><STRONG>Next message:</STRONG> <A HREF="0977.html">allyn romanow: "New co-chair, Mark Allman"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0975.html">Vern Paxson: "Last Call for Testing Tools I-D"</A>
<!-- nextthread="start" -->
<!-- reply="end" -->
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#976">[ date ]</A>
<A HREF="index.html#976">[ thread ]</A>
<A HREF="subject.html#976">[ subject ]</A>
<A HREF="author.html#976">[ author ]</A>
</UL>
<HR NOSHADE><P>
<!-- body="start" -->
<P>
Hello all,
<BR>
<P>I'm currently working on TCP security-related changes on SINIX (Siemens 
<BR>
Nixdorf UNIX) systems. I'm relativly new to the TCP subject and hope you could
<BR>
help me:
<BR>
<P>In BSD-derived TCP implementations the connection-establishment timer and 
<BR>
the keep-alive timer share the same counter timer[TCPT_KEEP]. This is
<BR>
just fine but when a single packet with a SYN-bit set arrives on a 
<BR>
connecting socket (waiting for the first response after active open SYN 
<BR>
sending), the timer gets the usual tcp_keepidle value (see Stevens 2, 
<BR>
tcp_input.c, line 339 tp-&gt;t_timer[TCPT_KEEP] = tcp_keepidle;): 2 hours and 
<BR>
the connection isn't established yet!
<BR>
This comes because after every packet receiving the timer gets this value.
<BR>
<P>I think (it may be wrong) that this is a bad behaviour, because when the SYN 
<BR>
packet (without ACK, so to prevent changing to the TCPS_ESTABLISHED state) 
<BR>
was an attack and nothing more comes in at this connection, this port is dead
<BR>
for the next two hours. 
<BR>
<P>The same problem arises, when someone from A telnet to a computer B behind a 
<BR>
wrongly configured firewall (a custumer of mine had this problem recently):
<BR>
The first SYN (from A) comes in (wrong behaviour of the firewall), the SYN/ACK
<BR>
(from B) gets filtered, so A resends its SYN packet and B (now in SYN_SENT) 
<BR>
resets the timer to tcp_keepidle and telnet is dead on B for the next 2 hours.
<BR>
<P>I think the timer should be reset to tcp_keepidle only if the state is at 
<BR>
least TCPS_ESTABLISHED. In the 2 position with the state transition to 
<BR>
TCPS_ESTABLISHED (passive and active open) the timer must be set as well. 
<BR>
<P>Bye, 
<BR>
Uwe Girlich, <A HREF="mailto:Uwe.Girlich@philosys.de?Subject=Re:%20TCP%20timer%20problem&In-Reply-To=&lt;199803090738.IAA03831@philos.philosys.de&gt;">Uwe.Girlich@philosys.de</A>
<BR>
<P><!-- body="end" -->
<HR NOSHADE>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0977.html">allyn romanow: "New co-chair, Mark Allman"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0975.html">Vern Paxson: "Last Call for Testing Tools I-D"</A>
<!-- nextthread="start" -->
<!-- reply="end" -->
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#976">[ date ]</A>
<A HREF="index.html#976">[ thread ]</A>
<A HREF="subject.html#976">[ subject ]</A>
<A HREF="author.html#976">[ author ]</A>
</UL>
<!-- trailer="footer" -->
<HR NOSHADE>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.hypermail.org/">hypermail 2b29</A> 
: <EM>Tue Sep 19 2000 - 11:52:23 EDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
