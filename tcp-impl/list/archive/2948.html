<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>TCP-IMPL Mailing List Archive: Updating timestamps (ts_recent)</TITLE>
<META NAME="Author" CONTENT="Duke, Martin (martin.duke@boeing.com)">
<META NAME="Subject" CONTENT="Updating timestamps (ts_recent) in Linux">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1>Updating timestamps (ts_recent) in Linux</H1>
<!-- received="Fri Jul 11 16:45:53 2003" -->
<!-- isoreceived="20030711204553" -->
<!-- sent="Fri, 11 Jul 2003 13:23:08 -0700" -->
<!-- isosent="20030711202308" -->
<!-- name="Duke, Martin" -->
<!-- email="martin.duke@boeing.com" -->
<!-- subject="Updating timestamps (ts_recent) in Linux" -->
<!-- id="B96DB973FD58EE469E4426886240EE97787918@xch-nw-03.nw.nos.boeing.com" -->
<STRONG>From:</STRONG> Duke, Martin (<A HREF="mailto:martin.duke@boeing.com?Subject=Re:%20Updating%20timestamps%20(ts_recent)%20in%20Linux&In-Reply-To=&lt;B96DB973FD58EE469E4426886240EE97787918@xch-nw-03.nw.nos.boeing.com&gt;"><EM>martin.duke@boeing.com</EM></A>)<BR>
<STRONG>Date:</STRONG> Fri Jul 11 2003 - 16:23:08 EDT
<P>
<!-- next="start" -->
<UL>
<LI><STRONG>Previous message:</STRONG> <A HREF="2947.html">Murali Bashyam: "Question on detecting duplicate segments"</A>
<!-- nextthread="start" -->
<!-- reply="end" -->
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#2948">[ date ]</A>
<A HREF="index.html#2948">[ thread ]</A>
<A HREF="subject.html#2948">[ subject ]</A>
<A HREF="author.html#2948">[ author ]</A>
</UL>
<HR NOSHADE><P>
<!-- body="start" -->
<P>
I've heard rumors that this has been discussed before on tcp-impl, but an extensive search found no messages on this topic.
<BR>
<P>How do people feel about the way Linux decides what timestamp to echo?
<BR>
<P>Specifically, although the behavior is compliant with RFC 1323, an old addendum to the RFC (<A HREF="http://www.kohala.com/start/tcplw-extensions.txt">http://www.kohala.com/start/tcplw-extensions.txt</A>) pointed out some odd behavior.
<BR>
<P>Essentially, if the connection goes down, the subsequent retransmissions will have later ts values.  However, if an ACK was lost, the kernel currently does not update ts_recent with these values.  If the channel comes back up and a retrans succeeds, the client will send an ack with an ts echo equal to the old value of ts_recent.
<BR>
<P>As the difference between the echo and the current time is quite large, it 
<BR>
will result in an extremely large RTT measurement, triggering a huge increase 
<BR>
in the RTO.  In an unreliable, bursty link, such as satellites, another outage 
<BR>
could occur shortly thereafter, and an inappropriately long timeout can occur.
<BR>
<P>The reason for the problem is that ts_recent is only updated if the receive window moves to the right.  Ideally, packets with sequence numbers to the left of the window edge should trigger an update as well.
<BR>
<P>There are certainly situations where the current Linux behavior is terrible, but I have yet to see an explanation for why this &quot;bug&quot; should not be fixed.  I've heard criticisms of the document cited above as a whole but have yet to understand why updating ts_recent more frequently will break something.  I know that BSD fixed this some time ago (Stevens talks about it in his book).
<BR>
<P>Any thoughts?
<BR>
<P>Martin Duke
<BR>
<A HREF="mailto:martin.duke@boeing.com?Subject=Re:%20Updating%20timestamps%20(ts_recent)%20in%20Linux&In-Reply-To=&lt;B96DB973FD58EE469E4426886240EE97787918@xch-nw-03.nw.nos.boeing.com&gt;">martin.duke@boeing.com</A>
<BR>
<P><!-- body="end" -->
<HR NOSHADE>
<UL>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="2947.html">Murali Bashyam: "Question on detecting duplicate segments"</A>
<!-- nextthread="start" -->
<!-- reply="end" -->
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#2948">[ date ]</A>
<A HREF="index.html#2948">[ thread ]</A>
<A HREF="subject.html#2948">[ subject ]</A>
<A HREF="author.html#2948">[ author ]</A>
</UL>
<!-- trailer="footer" -->
<HR NOSHADE>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.hypermail.org/">hypermail 2b29</A> 
: <EM>Fri Jul 11 2003 - 16:46:01 EDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
